<div class="reports-page p-4 sm:p-6 bg-gray-50 max-h-screen">
    <app-navigation></app-navigation>

    <!-- Page Header -->
    <header class="mb-6">
        <h1 class="text-2xl font-semibold text-gray-800">Reports</h1>
    </header>

    <!-- Filter Bar (Keep as before) -->
    <div class="filter-bar mb-6 flex flex-wrap items-center gap-3 sm:gap-4">
        <span class="p-input-icon-left search-input w-full max-w-xs">
            <i class="pi pi-search text-gray-400"></i>
            <input type="text" pInputText placeholder="Search reports..." class="w-full !h-10 !text-sm" [(ngModel)]="searchTerm" (ngModelChange)="onFilterChange()" />
        </span>
        <div class="relative">
            <p-calendar [(ngModel)]="selectedDateRange" selectionMode="range" [readonlyInput]="true" placeholder="Select date range" dateFormat="M d, yy" [showIcon]="true" iconDisplay="input" inputId="dateRange" appendTo="body" (onSelect)="onFilterChange()" (onClearClick)="onFilterChange()" class="calendar-orange" [styleClass]="'!h-10 !text-sm'">
                 <ng-template pTemplate="inputicon" class="absolute right-2 top-1/2 -translate-y-1/2"> <i class="pi pi-calendar text-gray-500"></i> </ng-template>
            </p-calendar>
        </div>
        <p-dropdown [(ngModel)]="selectedStatus" [options]="statusOptions" optionLabel="label" optionValue="value" placeholder="All Status" (onChange)="onFilterChange()" styleClass="filter-dropdown !h-10 !text-sm" [style]="{'min-width': '120px'}" appendTo="body">
            <ng-template pTemplate="selectedItem">
                <span class="capitalize">{{selectedStatus ? (selectedStatus | titlecase) : 'All Status'}}</span>
            </ng-template>
            <ng-template let-option pTemplate="item">
                <span class="capitalize">{{option.label}}</span>
            </ng-template>
        </p-dropdown>
    </div>

    <!-- Reports Grid (Keep as before) -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mb-6">
        <div *ngFor="let report of paginatedReports" class="report-card bg-white rounded-lg shadow border border-gray-100 p-4 flex flex-col justify-between transition-shadow hover:shadow-md">
            <div>
                <div class="flex items-center gap-3 mb-3">
                    <p-avatar [image]="report.authorAvatarUrl || 'assets/images/avatar-placeholder.png'" size="large" shape="circle" [style]="{'background-color': '#dee2e6', 'color': '#ffffff'}"></p-avatar>
                    <div>
                        <div class="font-medium text-gray-800 text-sm">{{ report.authorName }}</div>
                        <div class="text-xs text-gray-500">{{ report.authorDept }}</div>
                    </div>
                </div>
                <h3 class="text-base font-semibold text-gray-900 mb-2">{{ report.title }}</h3>
                <div class="flex items-center gap-1.5 text-xs text-gray-500 mb-3"> <i class="pi pi-calendar text-sm"></i> <span>{{ report.date | date:'MMM d, yyyy' }}</span> </div>
                <div> <span class="status-badge px-2.5 py-0.5 rounded-full text-xs font-medium inline-block capitalize" [ngClass]="getStatusClass(report.status)"> {{ report.status }} </span> </div>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-100"> <button pButton type="button" label="View Report" class="w-full p-button-outlined p-button-danger !h-9 !text-sm" (click)="viewReport(report)"></button> </div>
        </div>
        <div *ngIf="filteredReports.length === 0 && allReports.length > 0" class="col-span-full text-center text-gray-500 py-10"> No reports found matching your criteria. </div>
        <div *ngIf="allReports.length === 0" class="col-span-full text-center text-gray-500 py-10"> There are no reports to display. </div>
    </div>

    <!-- Pagination Footer (Keep as before) -->
    <div class="pagination-footer flex flex-col sm:flex-row justify-between items-center gap-4 bg-white p-3 rounded-lg shadow border border-gray-100" *ngIf="totalRecords > 0">
        <span class="text-sm text-gray-600">{{ paginationSummary }}</span>
        <p-paginator [rows]="rows" [totalRecords]="totalRecords" [first]="first" (onPageChange)="onPageChange($event)" [rowsPerPageOptions]="[6, 12, 24]" styleClass="p-0 bg-transparent border-none"> </p-paginator>
    </div>

</div> <!-- End reports-page -->


<!-- ======================= UPDATED REPORT DETAIL DIALOG ======================= -->
<p-dialog [(visible)]="displayReportModal" [modal]="true"
          [style]="{width: '90vw', maxWidth: '550px'}"  
          [draggable]="false" [resizable]="false" [dismissableMask]="false"
          (onHide)="closeReportModal()" styleClass="report-detail-dialog-new"
          [attr.data-key]="modalKey">

    <!-- Only render content when a report is selected -->
    <ng-container *ngIf="selectedReportForModal">


        <!-- Dialog Content Area -->
        <div class="pt-0 pb-5 px-5 space-y-6"> <!-- Adjusted padding -->
            <!-- Report Header inside content -->
            <div class="flex items-center gap-4">
                <p-avatar [image]="selectedReportForModal.authorAvatarUrl || 'assets/images/avatar-placeholder.png'"
                          size="xlarge" shape="circle"
                          [style]="{'background-color': '#e5e7eb', 'color': '#4b5563', 'width': '48px', 'height': '48px'}"></p-avatar>
                <div>
                    <h2 class="text-lg sm:text-xl font-semibold text-gray-900 mb-0 leading-tight">{{ selectedReportForModal.title }}</h2>
                    <p class="text-sm text-gray-500">{{ selectedReportForModal.authorDept }}</p>
                </div>
            </div>

            <!-- Date Section -->
            <div>
                <label class="block text-xs font-medium text-gray-500 mb-1 uppercase tracking-wider">Date</label>
                <p class="text-sm text-gray-800">{{ selectedReportForModal.date | date:'MMM d, yyyy' }}</p>
            </div>

            <!-- Status Section -->
            <div>
                <label class="block text-xs font-medium text-gray-500 mb-1 uppercase tracking-wider">Status</label>
                <span class="status-badge px-3 py-1 rounded-full text-xs font-semibold inline-block capitalize"
                      [ngClass]="getStatusClass(selectedReportForModal.status)">
                    {{ selectedReportForModal.status | titlecase }} <!-- Use TitleCasePipe -->
                </span>
            </div>

            <!-- Description Section -->
            <div>
                <label class="block text-xs font-medium text-gray-500 mb-1 uppercase tracking-wider">Description</label>
                <div class="text-sm text-gray-700 bg-gray-50 p-4 rounded-lg border border-gray-200 whitespace-pre-wrap min-h-[80px]">
                    {{ selectedReportForModal.description || 'No description available.' }}
                </div>
            </div>
        </div>

        <!-- Dialog Footer with Action Buttons -->
    </ng-container> <!-- End *ngIf="selectedReportForModal" -->
    <ng-template pTemplate="footer">
        <div *ngIf="selectedReportForModal" class="flex justify-between items-center w-full gap-3">
            <!-- Reject Button -->
            <button pButton type="button"
                    class="p-button-outlined p-button-danger flex-1 !py-2.5 !px-4 !text-sm"
                    (click)="updateReportStatus('pending')"
                    pTooltip="Mark as Pending/Rejected" tooltipPosition="top">
                <i class="pi pi-times mr-2"></i>
                <span>Reject</span>
            </button>

            <!-- In Progress Button -->
            <button pButton type="button"
                    class="p-button-outlined p-button-info flex-1 !py-2.5 !px-4 !text-sm"
                    (click)="updateReportStatus('in progress')"
                    pTooltip="Mark as In Progress" tooltipPosition="top">
                <i class="pi pi-clock mr-2"></i>
                <span>In Progress</span>
            </button>

            <!-- Accept Button -->
            <button pButton type="button"
                    class="p-button-success flex-1 !py-2.5 !px-4 !text-sm"
                    (click)="updateReportStatus('completed')"
                    pTooltip="Mark as Completed/Accepted" tooltipPosition="top">
                <i class="pi pi-check mr-2"></i>
                <span>Accept</span>
            </button>
        </div>
    </ng-template>
</p-dialog>