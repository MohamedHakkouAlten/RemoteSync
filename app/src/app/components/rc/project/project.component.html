<app-default-layout >
<div class="projects-layout">
<p-toast   position="top-center" styleClass="w-full md:w-auto  z-50"></p-toast>

    <main class="projects-container">
        <header class="projects-header">
            <h1>{{ 'projectPage.title' | translate }}</h1>
            <p>{{ 'projectPage.subtitle' | translate }}</p>
        </header>

        <div class="summary-stats">
            <span>{{ 'projectPage.summaryStats.totalProjects' | translate }} <strong class="count">{{ totalProjectCount }}</strong></span>
            <span class="stat-item"><span class="w-3 h-3 bg-green-500 rounded-full"></span>{{ 'projectPage.summaryStats.completed' | translate }} <strong class="count">{{ completedProjectCount }}</strong></span>
            <span class="stat-item"><span class="w-3 h-3 bg-blue-500 rounded-full"></span>{{ 'projectPage.summaryStats.active' | translate }} <strong class="count">{{ activeProjectCount }}</strong></span>
            <span class="stat-item"><span class="w-3 h-3 bg-yellow-400 rounded-full"></span>{{ 'projectPage.summaryStats.inactive' | translate }} <strong class="count">{{ inActiveProjectCount }}</strong></span>
            <span class="stat-item"><span class="w-3 h-3 bg-red-500 rounded-full"></span>{{ 'projectPage.summaryStats.cancelled' | translate }} <strong class="count">{{ cancelledProjectCount }}</strong></span>
        </div>

        <div class="toolbar">
            <p-iconField iconPosition="left" class="search-field">
                <p-inputIcon styleClass="pi pi-search" />
                <input
                    pInputText
                    type="text"
                    [(ngModel)]="searchLabel"
                    (input)="searchByLabel($event)"
                    [placeholder]="'projectPage.toolbar.searchProjectsPlaceholder' | translate" />
            </p-iconField>
            <p-iconField iconPosition="left" class="search-field">
                <p-inputIcon styleClass="pi pi-user" />
                <input
                    pInputText
                    type="text"
                    [(ngModel)]="searchClient"
                    (input)="searchByClient($event)"
                    [placeholder]="'projectPage.toolbar.searchClientPlaceholder' | translate" />
            </p-iconField>
            <button type="button" class=" bg-primary  h-[40px] cursor-pointer rounded-full w-[40px] pt-1 pr-0.5" (click)="onClear()" [pTooltip]="'projectPage.toolbar.clearSearchTooltip' | translate" tooltipPosition="top">
                <i  class="pi pi-times text-white !text-[18px]" ></i>
            </button>
            <button pButton type="button" [label]="'projectPage.toolbar.newProjectButton' | translate" icon="pi pi-plus" class="p-button-warning new-project-button" (click)="showCreateProjectDialog()"></button>
        </div>

        <div class="table-container">
            <p-table
                #projectTable
                [value]="allProjects"
                [paginator]="true"
                [rows]="this.state().rows()"
                [first]="this.state().first()"
                [lazy]="true"
                [showCurrentPageReport]="true"
                [totalRecords]="totalRecords"
                (onSort)="onSortChange($event)"
                (onPage)="onPageChange($event)"
                [currentPageReportTemplate]="'projectPage.table.paginationReport' | translate"
                [rowsPerPageOptions]="[5, 10, 25, 50]"
                dataKey="id"
                styleClass="custom-table"
                >

                <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="label">{{ 'projectPage.table.header.label' | translate }} <p-sortIcon field="label"></p-sortIcon></th>
                        <th pSortableColumn="titre">{{ 'projectPage.table.header.projectName' | translate }} <p-sortIcon field="titre"></p-sortIcon></th>
                        <th pSortableColumn="client">{{ 'projectPage.table.header.client' | translate }} <p-sortIcon field="client"></p-sortIcon></th>
                        <th>{{ 'projectPage.table.header.duration' | translate }}</th>
                        <th pSortableColumn="status">{{ 'projectPage.table.header.status' | translate }} <p-sortIcon field="status"></p-sortIcon></th>
                        <th>{{ 'projectPage.table.header.actions' | translate }}</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-project> <!-- Corrected #body to pTemplate="body" -->
                    <tr>
                        <td class="rc-cell">
                            {{project?.label}}
                        </td>
                        <td>{{ project.titre}}</td>
                        <td>{{ project?.owner?.label}}</td>
                        <td>{{ project.startDate+" - "+project.deadLine }}</td>
                        <td>
                            <!-- Use the helper function for translated status -->
                            <p-tag [value]="getTranslatedStatus(project.status)" [severity]="getStatusSeverity(project.status)" [rounded]="true"></p-tag>
                        </td>
                        <td class="actions-cell">
                            <ng-container *ngIf="project.isDeleted==false">
                                <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-text p-button-secondary" (click)="editProject(project)" [pTooltip]="'projectPage.table.actionsTooltip.edit' | translate" tooltipPosition="top"></button>
                            </ng-container>
                            <button pButton pRipple icon="pi pi-eye" class="p-button-rounded p-button-text p-button-secondary" (click)="viewProject(project)" [pTooltip]="'projectPage.table.actionsTooltip.view' | translate" tooltipPosition="top"></button>
                            <button [disabled]="project.isDeleted==true" pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-text p-button-danger" (click)="deleteProject(project)" [pTooltip]="'projectPage.table.actionsTooltip.delete' | translate" tooltipPosition="top"></button>
                        </td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td [attr.colspan]="6" class="text-center" style="padding: 2rem;">{{ 'projectPage.table.emptyMessage' | translate }}</td> <!-- Adjusted colspan -->
                    </tr>
                </ng-template>

                <ng-template pTemplate="loadingbody">
                    <tr>
                        <td [attr.colspan]="6" class="text-center" style="padding: 2rem;"> <!-- Adjusted colspan -->
                            <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
                            <span style="display: block; margin-top: 0.5rem;">{{ 'projectPage.table.loadingMessage' | translate }}</span>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </main>

    <!-- =========================== -->
    <!-- === CREATE PROJECT DIALOG === -->
    <!-- =========================== -->
    <app-add-project (hideDialog)="hideCreateProjectDialog()" (saveProject)="saveNewProject($event)" [displayCreateProjectDialog]="displayCreateProjectDialog" />
    <!-- ========================= -->
    <!-- === EDIT PROJECT DIALOG === -->
    <!-- ========================= -->
    <app-edit-project (hideDialog)="hideEditProjectDialog()" [displayEditProjectDialog]="displayEditProjectDialog" (editeProject)="updateProject($event)" [projectToEdit]="projectToEdit" />
    <!-- ======================================= -->
    <!-- === VIEW PROJECT DIALOG (Image Style) === -->
    <!-- ======================================= -->
    <app-view-project (hideDialog)="hideViewProjectDialog()" [displayViewProjectDialog]="displayViewProjectDialog" [projectToView]="projectToView" />
</div>
</app-default-layout>